---
title: "R Tutorial #2 -- Econ 103"
output:
  html_document:
    toc: true
    theme: readable
    css: custom.css
  pdf_document:
    toc: true
    highlight: zenburn
---
This tutorial has two parts. In the first part, you'll compute summary 
statistics and graphs using R. In the second part, you'll use what you've 
learned to explore a real-world dataset: the passenger manifest from the Titanic.

## Summary Stats and Graphics

### Load and View the Data
In this section we'll work with car data that is preloaded in R. First, make sure
you have the "datasets" package loaded and then create a data.table with the data.
```{r}
library(datasets)
carData <- mtcars
```
It's always a good idea to take a look at your data after loading it. 
The functions ``head`` and ``tail``, introduced in the previous tutorial, 
make this easy (this dataset is small enough that you can see the whole thing too):
```{r}
head(carData)
tail(carData)
```

### Making Histograms
Making beautiful charts is a valuable skill. Unfortunately, the default R graphics
are really ugly. Thankfully, there's a package for that! You'll need to install 
the ``plotly`` package to generate the prettier charts. Another huge plus is that
it makes **interactive charts**!

Generating a chart is a simple matter of using the command 
``plot_ly(data, xData, yData, chartType, mode)`` (there's tons of other options, but 
we'll only focus on the basics). A histogram is just a frequency chart of one 
variable, so there's no need to specify the ``y`` variable when you're making
a histogram.
```{r}
library(plotly)
plot_ly(data = carData, x = mpg, type = "histogram")
```
The chart isn't too well labeled. Having a title and proper axis labels would 
be nice. Let's add the proper labels. 
```{r}
plot_ly(data = carData, x = mpg, type = "histogram") %>% 
  layout(title = "MPG Histogram", xaxis = list(title = "MPG"), 
         yaxis = list(title = "Frequency"))
```
The reason the ``xaxis`` and ``yaxis`` options are lists is because they can 
take many, many more formatting options. Below is an example of using those options
to pretty up the graph even more.
```{r}
xAxisTemplate <- list(title = "MPG", showgrid = FALSE, range = c(0, 40),
                      showticklabels = TRUE, ticks = "outside", 
                      linecolor = "#000", tick0 = 0, dtick = 5)
yAxisTemplate <- list(title = "Frequency", showgrid = TRUE, range = c(0, 20),
                      showticklabels = TRUE, ticks = "outside", 
                      linecolor = "#000", tick0 = 0, dtick = 5)
plot_ly(data = carData, x = mpg, type = "histogram") %>%
  layout(title = "MPG Histogram", xaxis = xAxisTemplate, yaxis = yAxisTemplate)
```

By default, R produces histograms in terms of *frequencies*. That is, it counts 
the *numbers* of observations in each bin. To change this to 
*relative frequencies*, that is proportions, we add the argument ``histnorm``
and set it to ``percent``. Note, I also changed the y-axis label.
```{r}
plot_ly(data = carData, x = mpg, type = "histogram", histnorm = "percent") %>% 
  layout(title = "MPG Histogram", xaxis = list(title = "MPG"), 
         yaxis = list(title = "Percent"))
```

### Scatter Plots
Making scatter plots is very similar to how we made histograms, with the 
appropriate change to the plot ``type`` as well as specifying the ``y`` data. 
Let's make a scatter plot of horsepower and MPG.
```{r}
plot_ly(data = carData, x = mpg, y = hp, type = "scatter", mode = "markers") %>% 
  layout(title = "MPG and Horsepower", xaxis = list(title = "MPG"), 
         yaxis = list(title = "Horsepower"))
```

Let's say your were interested in how different engine sizes were related to this 
scatter. You could color the dots by the number of cylinders (I converted "cyl"
to an integer, otherwise R thinks it is a continuous variable)
```{r}
carData$cyl <- as.integer(carData$cyl)
plot_ly(data = carData, x = mpg, y = hp, type = "scatter", 
        mode = "markers", color = cyl) %>% 
  layout(title = "MPG and Horsepower", xaxis = list(title = "MPG"), 
         yaxis = list(title = "Horsepower"))
```
If you're familiar with cars, the color grouping should not surprise you.

### Box Plots
A boxplot is an alternative way to visualize the distribution of a dataset. 
Once again, a few tweaks to the chart type should give us what we need.
```{r}
plot_ly(data = carData, y = mpg, type = "box", boxpoints = FALSE) %>% 
  layout(title = "MPG Box Plot")
```
Let's say you're interested in the MPG spread by engine size. How can you easily 
create the box plots for those different groups? Just tell R that you want to 
group the data by ``cyl`` and you're good to go!
```{r}
plot_ly(data = carData, y = mpg, type = "box", boxpoints = FALSE, 
        group = cyl) %>% 
  layout(title = "MPG Box Plot")
```

### ``table``
The command ``table`` is used for making cross-tabs, aka two-way tables, which 
are a useful way of summarizing the relationship between two categorical 
variables. Both arguments of table must be vectors. For example, we can make 
a cross-tab of engine size (cylinders) and transmission type (auto or manual) follows:
```{r}
table(carData$cyl, carData$am)
```
Most 8-cylinder engines tend to have automatic transmissions, while smaller engines
(4 cylinders) tend to have manual transmissions. 

We can also use ``table`` to make a *one-way* crosstab:
```{r}
table(carData$cyl)
```

Adding the row and column sums is a little clumsy in R: you first need to give 
your table a name and store it, then use the function ``addmargins``
```{r}
carTable <- table(carData$cyl, carData$am)
addmargins(carTable)
```

To convert a cross-tab in R into *percents* rather than counts, we use the 
function prop.table. This is a little clumsy as well. First, store the original 
table, then pass it as the argument to ``prop.table`` as you did with ``addmargins`` 
```{r}
carTable <- table(carData$cyl, carData$am)
prop.table(carTable)
```

Now you have a table in which percents are expressed as *decimals*. For example, 
the value of 0.25 in the row ``4`` and the column ``1`` indicates 
that 25% of the cars in the dataset have 4-cylinder engines with manual transmission.

To get ordinary percents, we multiply by 100
```{r}
100 * prop.table(carTable)
```
To make this cleaner we can round the result to a desired number of decimal places:
```{r}
round(100 * prop.table(carTable), digits = 1)
round(100 * prop.table(carTable), digits = 0)
```

### Summary Statistics
The ``summary`` command takes a *whole dataframe* as its argument, unlike the other 
commands for summary statistics. It gives us the mean of each column along 
with the five-number summary. It also indicates if there are any missing 
observations (NA's) in the columns:
```{r}
summary(carData)
```

### ``mean``
Calculates the sample mean of a numeric vector
```{r}
mean(carData$mpg, na.rm = TRUE)
```

### ``median``
Calculates the sample median of a numeric vector
```{r}
median(carData$mpg, na.rm = TRUE)
```

### ``var``
Calculates the sample variance of a numeric vector
```{r}
var(carData$mpg, na.rm = TRUE)
```

### ``sd`` 
Calculates the sample standard deviation of a numeric vector
```{r}
sd(carData$mpg, na.rm = TRUE)
```
This is identical to the (positive) square root of the sample variance:
```{r}
sqrt(var(carData$mpg, na.rm = TRUE))
```

### ``IQR``
Calculates the interquartile range of a numeric vector (the 75th percentile minus the 25th percentile)
```{r}
IQR(carData$mpg, na.rm = TRUE)
```

### ``max, min``
These do exactly what they say
```{r}
max(carData$mpg, na.rm = TRUE)
min(carData$mpg, na.rm = TRUE)
```
and can be used to calculate the range
```{r}
max(carData$mpg, na.rm = TRUE) - min(carData$mpg, na.rm = TRUE)
```
To get both the maximum and minimum at once, you can use the function range;
```{r}
range(carData$mpg, na.rm = TRUE)
```
Note that this does *not* compute the *summary statistic* called the range. 

### ``quantile``
This function calculates sample quantiles, aka percentiles, of a numeric vector. 
If you simply pass it a numeric vector with no other arguments, it will give 
you the five-number summary:
```{r}
quantile(carData$mpg, na.rm = TRUE)
```
You can ask for specific quantile by using the argument probs
```{r}
quantile(carData$mpg, na.rm = TRUE, probs = 0.3)
```
Note that quantiles are specified as *probabilities* so the preceding command 
gives the 30th percentile. You can also ask for multiple quantiles at once:
```{r}
quantile(carData$mpg, na.rm = TRUE, probs = c(0.1, 0.3, 0.7, 0.9))
```

## Exploring the Titanic
Now it's your turn: using what you've learned above, you'll analyze some data
about everyone that was aboard the Titanic! You already know enough R to answer 
some interesting questions, so let's dive in! 

#### A Helpful Hint: Taking the mean of a vector of ones and zeros is the *same thing* as calculating the *proportion of ones*.

1. Read the documentation file for the titanic dataset so that you know what 
each column in the data represents: https://github.com/emallickhossain/Econ103Public/raw/master/Rtutorials/titanic.txt

2. Download the data, store it in a data table called titanic, and display the 
first few rows.
```{r echo=FALSE,results='hide',fig.show='hide'}
#Ex-2
library(data.table)
titanic <- fread("https://github.com/emallickhossain/Econ103Public/raw/master/Rtutorials/titanic3.csv")
head(titanic)
```

3. We'll only be using the following columns of titanic for this example: pclass, 
survived, sex, age, and fare. Select only these columns and store then in the 
data table titanic, overwriting the original dataset. Display the first few 
rows to make sure your command worked.
```{r echo=FALSE,results='hide',fig.show='hide'}
#Ex-3
titanic <- titanic[, list(pclass, survived, sex, age, fare)]
head(titanic)
```

4. Using the command summary to get an overview of the dataset and answer the following questions:
  - Are there any missing values in this dataset?
  - What was the average age of passengers on the Titanic?
  - What was the average ticket price for passengers on the ship?
  - Do the ticket prices show evidence of skewness? If so, are they positively or negatively skewed?
  - Were there more men or women aboard the Titanic?
  - What proportion of the passengers survived the disaster?
  - To which social class did most of the passengers belong?
```{r echo=FALSE,results='hide',fig.show='hide'}
#Ex-4
summary(titanic)
```
5. Being sure to allow for missing values if necessary, calculate (or plot) and interpret the following:
  - The standard deviation of fares
  - The 90th Percentile of fares 
  - Histogram of fares
```{r echo=FALSE,results='hide',fig.show='hide'}
#Ex-5
sd(titanic$fare, na.rm = TRUE)
quantile(titanic$fare, 0.9, na.rm = TRUE)
plot_ly(data = titanic, x = fare, type = "histogram")
```
6. Create a boxplot of ``fare`` by ``pclass`` and interpret your results.
```{r echo=FALSE,results='hide',fig.show='hide'}
#Ex-6
plot_ly(data = titanic, y = fare, group = pclass, type = "box", boxpoints = FALSE)
```
7. Create a data table called survivors, containing data for only those 
passengers who survived the disaster and answer the following questions:
  - What was the average age of the survivors? 
  - Among the survivors, were there more men or women? 
  - Do you notice anything different about social class for survivors compared to all passengers? 
```{r echo=FALSE,results='hide',fig.show='hide'}
#Ex-7
survivors <- titanic[survived == 1]
summary(survivors)
```
8. Determine whether men or women paid more, on average, for 
passage on the titanic. Hint: use something that looks like the following
``dataset[, operation, by = group]``
```{r echo=FALSE,results='hide',fig.show='hide'}
#Ex-8
titanic[, mean(fare, na.rm = TRUE), by = sex]
```
9. How did the fraction of survivors vary by ``sex`` ``pclass``? Can you think of a possible explanation for the pattern you see in the data? Hint: use something that looks like the following
``dataset[, operation, by = list(group1, group2)]``
```{r echo=FALSE,results='hide',fig.show='hide'}
#Ex-10
titanic[, mean(survived, na.rm = TRUE), by = list(sex, pclass)]
```
